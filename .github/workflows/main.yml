name: Update QA Quote

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-quote:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Generate QA Quote
        shell: bash
        run: |
          mkdir -p quotes
          QUOTES=(
            "A tester's job is to think like the user and break like a hacker."
            "Testing is the art of risk reduction."
            "Quality is built in, not tested in."
            "Great testers prevent disasters before users see them."
            "If you did not test it, you do not know it works."
            "Testing turns assumptions into confidence."
          )
          RANDOM_INDEX=$(( RANDOM % ${#QUOTES[@]} ))
          RANDOM_QUOTE="${QUOTES[$RANDOM_INDEX]}"
          echo "Generated quote: $RANDOM_QUOTE"

          cat <<EOF > quotes/quote.svg
<svg xmlns="http://www.w3.org/2000/svg" width="900" height="180">
  <rect width="900" height="180" rx="16" fill="#0d1117"/>
  <text x="40" y="80" fill="#58a6ff" font-size="22" font-family="Arial" font-style="italic">
    “$RANDOM_QUOTE”
  </text>
  <text x="860" y="130" fill="#8b949e" font-size="16" text-anchor="end">
    — Sagar Bankar | Software Test Engineer
  </text>
</svg>
EOF

      - name: Check for changes
        id: git-check
        run: |
          if git diff --quiet; then
            echo "No changes to commit"
            echo "changed=false" >> $GITHUB_OUTPUT
          else
            echo "Changes detected"
            echo "changed=true" >> $GITHUB_OUTPUT
          fi

      - name: Commit & Push changes
        if: steps.git-check.outputs.changed == 'true'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add quotes/quote.svg
          git commit -m "Update QA quote [skip ci]"
          git push
